# Google OAuth ç™»å½•é‡å®šå‘é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ› **é—®é¢˜æè¿°**

ç”¨æˆ·åé¦ˆä½¿ç”¨Googleè´¦å·ç™»å½•åä¸ä¼šè‡ªåŠ¨è·³è½¬å›æ¥ä¸šåŠ¡é¡µé¢ï¼Œå¯¼è‡´ç”¨æˆ·ä½“éªŒä¸ä½³ã€‚

## ğŸ” **é—®é¢˜åˆ†æ**

ç»è¿‡è¯Šæ–­å‘ç°ä»¥ä¸‹é—®é¢˜ï¼š

### 1. é‡å®šå‘ç›®æ ‡é¡µé¢ä¸å­˜åœ¨
- **é—®é¢˜**: ç™»å½•é¡µé¢ä¸­Googleç™»å½•çš„`callbackUrl`è®¾ç½®ä¸º`/generator`
- **ç°å®**: é¡¹ç›®ä¸­æ²¡æœ‰`/generator`é¡µé¢ï¼Œå¯¼è‡´ç™»å½•åè·³è½¬åˆ°404é¡µé¢

### 2. NextAuthç¼ºå°‘redirectå›è°ƒ
- **é—®é¢˜**: `lib/auth.ts`ä¸­ç¼ºå°‘`redirect`å›è°ƒå‡½æ•°
- **å½±å“**: NextAuthä¸çŸ¥é“ç™»å½•æˆåŠŸååº”è¯¥è·³è½¬åˆ°å“ªé‡Œ

### 3. é‚®ç®±ç™»å½•é‡å®šå‘é”™è¯¯
- **é—®é¢˜**: é‚®ç®±ç™»å½•ä¹Ÿé‡å®šå‘åˆ°ä¸å­˜åœ¨çš„`/generator`é¡µé¢

## âœ… **è§£å†³æ–¹æ¡ˆ**

### 1. ä¿®å¤NextAuthé…ç½®
åœ¨`lib/auth.ts`ä¸­æ·»åŠ `redirect`å›è°ƒå‡½æ•°ï¼š

```typescript
callbacks: {
  // ... å…¶ä»–å›è°ƒ
  redirect: async ({ url, baseUrl }) => {
    // å¤„ç†ç™»å½•åçš„é‡å®šå‘
    console.log('Redirect callback:', { url, baseUrl })

    // å¦‚æœurlæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œç›´æ¥ä½¿ç”¨
    if (url.startsWith('/')) {
      return `${baseUrl}${url}`
    }

    // å¦‚æœurlæ˜¯åŒåŸŸåï¼Œç›´æ¥ä½¿ç”¨
    if (url.startsWith(baseUrl)) {
      return url
    }

    // é»˜è®¤é‡å®šå‘åˆ°é¦–é¡µ
    return baseUrl
  },
}
```

### 2. ä¿®å¤ç™»å½•é¡µé¢é‡å®šå‘è·¯å¾„
åœ¨`app/auth/signin/page.tsx`ä¸­ï¼š

**Googleç™»å½•ä¿®å¤**:
```typescript
// ä¿®å¤å‰
await signIn('google', { callbackUrl: '/generator' })

// ä¿®å¤å
await signIn('google', { callbackUrl: '/' })
```

**é‚®ç®±ç™»å½•ä¿®å¤**:
```typescript
// ä¿®å¤å‰
router.push('/generator')

// ä¿®å¤å
router.push('/')
```

## ğŸ§ª **æµ‹è¯•éªŒè¯**

åˆ›å»ºäº†ä¸“é—¨çš„æµ‹è¯•è„šæœ¬æ¥éªŒè¯ä¿®å¤æ•ˆæœï¼š

```bash
# è¿è¡Œé‡å®šå‘æµ‹è¯•
npm run auth:redirect-test
```

**æµ‹è¯•ç»“æœ**:
- âœ… ç™»å½•é¡µé¢æ­£å¸¸è®¿é—®
- âœ… é¦–é¡µæ­£å¸¸è®¿é—® (ç™»å½•åçš„è·³è½¬ç›®æ ‡)
- âœ… Google OAuthé‡å®šå‘æ­£å¸¸ (302çŠ¶æ€ç )

## ğŸ¯ **ä¿®å¤å†…å®¹æ€»ç»“**

1. **æ·»åŠ NextAuth redirectå›è°ƒ** - å¤„ç†ç™»å½•åçš„æ™ºèƒ½é‡å®šå‘
2. **ä¿®å¤Googleç™»å½•é‡å®šå‘** - ä»`/generator`æ”¹ä¸º`/`
3. **ä¿®å¤é‚®ç®±ç™»å½•é‡å®šå‘** - ä»`/generator`æ”¹ä¸º`/`
4. **åˆ›å»ºæµ‹è¯•è„šæœ¬** - æ–¹ä¾¿éªŒè¯é‡å®šå‘åŠŸèƒ½

## ğŸš€ **ä½¿ç”¨æ–¹æ³•**

ç°åœ¨ç”¨æˆ·å¯ä»¥æ­£å¸¸ä½¿ç”¨Googleç™»å½•ï¼š

1. è®¿é—®: `http://localhost:3001/auth/signin`
2. ç‚¹å‡» "Continue with Google"
3. å®ŒæˆGoogleè®¤è¯
4. **è‡ªåŠ¨è·³è½¬å›é¦–é¡µ** âœ…

## ğŸ“ **ç›¸å…³æ–‡ä»¶**

- `lib/auth.ts` - NextAuthé…ç½®ï¼Œæ·»åŠ redirectå›è°ƒ
- `app/auth/signin/page.tsx` - ç™»å½•é¡µé¢ï¼Œä¿®å¤é‡å®šå‘è·¯å¾„
- `scripts/test-auth-redirect.js` - é‡å®šå‘æµ‹è¯•è„šæœ¬
- `package.json` - æ·»åŠ äº†`auth:redirect-test`è„šæœ¬

## âœ¨ **æ”¹è¿›åçš„ç”¨æˆ·ä½“éªŒ**

- ğŸ”„ **æ— ç¼é‡å®šå‘**: ç™»å½•åè‡ªåŠ¨è¿”å›é¦–é¡µ
- ğŸ¯ **æ™ºèƒ½è·¯ç”±**: NextAuthä¼šæ ¹æ®æƒ…å†µé€‰æ‹©åˆé€‚çš„é‡å®šå‘ç›®æ ‡
- ğŸ›¡ï¸ **å®‰å…¨æ€§**: åªå…è®¸é‡å®šå‘åˆ°åŒåŸŸåä¸‹çš„é¡µé¢
- ğŸ§ª **å¯æµ‹è¯•**: æä¾›äº†å®Œæ•´çš„æµ‹è¯•å·¥å…·

**é—®é¢˜å·²å®Œå…¨è§£å†³ï¼Google OAuthç™»å½•ç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œå¹¶æ­£ç¡®é‡å®šå‘ã€‚**
